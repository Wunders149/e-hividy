<%- include('partials/head', { title: 'Dashboard' }) %>
<%- include('partials/sidebar', { activePage: 'dashboard' }) %>

<main class="admin-main">
  <div class="page-header">
    <div>
      <h1><i data-lucide="layout-dashboard"></i> Dashboard</h1>
      <p class="text-muted" style="margin: 0.25rem 0 0 0; font-size: 0.9375rem;">Welcome back! Here's what's happening with your store today.</p>
    </div>
    <div class="page-header-actions">
      <a href="/admin/products/add" class="admin-btn">
        <i data-lucide="plus-circle"></i> Add Product
      </a>
    </div>
  </div>

  <!-- Stats Grid -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-card-header">
        <h3>Total Revenue</h3>
        <div class="stat-card-icon">
          <i data-lucide="dollar-sign"></i>
        </div>
      </div>
      <div class="number">$<%= parseFloat(stats.totalRevenue || 0).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2}) %></div>
      <div class="stat-card-change positive">
        <i data-lucide="trending-up"></i> Lifetime earnings
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-card-header">
        <h3>Total Orders</h3>
        <div class="stat-card-icon">
          <i data-lucide="shopping-bag"></i>
        </div>
      </div>
      <div class="number"><%= stats.totalOrders.toLocaleString() %></div>
      <div class="stat-card-change positive">
        <i data-lucide="package"></i> All time orders
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-card-header">
        <h3>Total Customers</h3>
        <div class="stat-card-icon">
          <i data-lucide="users"></i>
        </div>
      </div>
      <div class="number"><%= stats.totalUsers.toLocaleString() %></div>
      <div class="stat-card-change positive">
        <i data-lucide="user-plus"></i> Registered users
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-card-header">
        <h3>Total Products</h3>
        <div class="stat-card-icon">
          <i data-lucide="box"></i>
        </div>
      </div>
      <div class="number"><%= stats.totalProducts.toLocaleString() %></div>
      <div class="stat-card-change positive">
        <i data-lucide="archive"></i> In catalog
      </div>
    </div>
  </div>

  <div class="dashboard-grid">
    <!-- Recent Orders Card -->
    <div class="card" style="margin-bottom: 0;">
      <div class="card-header">
        <h2><i data-lucide="clock"></i> Recent Orders</h2>
        <a href="/admin/orders" class="admin-btn admin-btn-sm admin-btn-secondary">
          View All <i data-lucide="arrow-right" style="width: 14px; height: 14px; margin-left: 4px;"></i>
        </a>
      </div>
      <div class="card-body" style="padding: 0;">
        <% if (recentOrders && recentOrders.length > 0) { %>
          <div class="table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th>Order ID</th>
                  <th>Customer</th>
                  <th>Amount</th>
                  <th>Date</th>
                  <th style="width: 60px;"></th>
                </tr>
              </thead>
              <tbody>
                <% recentOrders.forEach(order => { %>
                  <tr>
                    <td>
                      <span class="font-semibold text-primary">#<%= order.id %></span>
                    </td>
                    <td><%= order.customer_name %></td>
                    <td>
                      <span class="font-semibold text-success">$<%= parseFloat(order.total_amount).toFixed(2) %></span>
                    </td>
                    <td>
                      <span class="text-muted small"><%= formatDate(order.created_at) %></span>
                    </td>
                    <td>
                      <a href="/admin/orders/<%= order.id %>" class="btn-action btn-action-view" title="View Details">
                        <i data-lucide="eye"></i>
                      </a>
                    </td>
                  </tr>
                <% }); %>
              </tbody>
            </table>
          </div>
        <% } else { %>
          <div class="empty-state">
            <i data-lucide="inbox" class="empty-state-icon"></i>
            <h3>No Orders Yet</h3>
            <p>Orders will appear here once customers start making purchases</p>
          </div>
        <% } %>
      </div>
    </div>

    <!-- Quick Actions & System Status -->
    <div class="quick-actions-card" style="margin-bottom: 0;">
      <div class="card">
        <div class="card-header">
          <h2><i data-lucide="zap"></i> Quick Actions</h2>
        </div>
        <div class="card-body">
          <div class="quick-actions-list">
            <a href="/admin/products/add" class="quick-action-item">
              <div class="quick-action-icon" style="background: var(--primary-light); color: var(--primary);">
                <i data-lucide="plus-circle"></i>
              </div>
              <span>Add Product</span>
            </a>
            <a href="/admin/products" class="quick-action-item">
              <div class="quick-action-icon" style="background: var(--info-light); color: var(--info);">
                <i data-lucide="package"></i>
              </div>
              <span>Inventory</span>
            </a>
            <a href="/admin/orders" class="quick-action-item">
              <div class="quick-action-icon" style="background: var(--success-light); color: var(--success);">
                <i data-lucide="clipboard-list"></i>
              </div>
              <span>Orders</span>
            </a>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top: 1.5rem;">
        <div class="card-header">
          <h2><i data-lucide="activity"></i> System Status</h2>
        </div>
        <div class="card-body">
          <div class="status-item">
            <div class="status-indicator success"></div>
            <div class="status-info">
              <span class="status-label">Database</span>
              <span class="status-value">Connected</span>
            </div>
          </div>
          <div class="status-item">
            <div class="status-indicator success"></div>
            <div class="status-info">
              <span class="status-label">Server</span>
              <span class="status-value">Online</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<style>
  .dashboard-grid {
    display: grid;
    grid-template-columns: 1fr 380px;
    gap: 1.5rem;
  }
  
  .quick-actions-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }
  
  .quick-action-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: var(--gray-50);
    border-radius: var(--radius-lg);
    text-decoration: none;
    color: var(--gray-700);
    font-weight: 500;
    transition: var(--transition);
    border: 1px solid transparent;
  }
  
  .quick-action-item:hover {
    background: var(--white);
    border-color: var(--gray-200);
    box-shadow: var(--shadow-sm);
    transform: translateX(4px);
    color: var(--primary);
  }
  
  .quick-action-icon {
    width: 44px;
    height: 44px;
    border-radius: var(--radius-lg);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }
  
  .quick-action-icon i {
    width: 20px;
    height: 20px;
  }
  
  .status-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.75rem 0;
    border-bottom: 1px solid var(--gray-100);
  }
  
  .status-item:last-child {
    border-bottom: none;
  }
  
  .status-indicator {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  
  .status-indicator.success {
    background: var(--success);
    box-shadow: 0 0 0 3px var(--success-light);
  }
  
  .status-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex: 1;
  }
  
  .status-label {
    color: var(--gray-600);
    font-size: 0.9375rem;
  }
  
  .status-value {
    color: var(--gray-900);
    font-weight: 600;
    font-size: 0.875rem;
  }
  
  @media (max-width: 1024px) {
    .dashboard-grid {
      grid-template-columns: 1fr;
    }
    
    .quick-actions-card {
      order: -1;
    }
  }
  
  @media (max-width: 768px) {
    .page-header {
      flex-direction: column;
      align-items: flex-start;
    }
    
    .page-header-actions {
      width: 100%;
    }
    
    .page-header-actions .admin-btn {
      width: 100%;
      justify-content: center;
    }
  }
</style>

<%- include('partials/footer') %>
<%- include('partials/scripts') %>
