<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage Products</title>
  <link rel="stylesheet" href="/admin.css">
</head>
<body>
  <button class="menu-toggle" onclick="toggleAdminMenu()">â˜°</button>
  
  <div class="admin-container">
    <aside class="admin-sidebar" id="adminSidebar">
      <h2>ğŸ”§ Admin</h2>
      <ul>
        <li><a href="/admin/dashboard">ğŸ“Š Dashboard</a></li>
        <li><a href="/admin/products" class="active">ğŸ“¦ Products</a></li>
        <li><a href="/admin/orders">ğŸ“‹ Orders</a></li>
        <li><a href="/admin/logout">ğŸšª Logout</a></li>
      </ul>
    </aside>

    <main class="admin-main">
      <div class="dashboard-header">
        <h1>Manage Products</h1>
        <a href="/admin/products/add" class="admin-btn">+ Add New Product</a>
      </div>

      <div class="admin-section">
        <% if (error) { %>
          <div class="message error"><%= error %></div>
        <% } %>

        <% if (products.length > 0) { %>
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Description</th>
                <th>Price</th>
                <th>Stock</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% products.forEach(product => { %>
                <tr>
                  <td><strong>#<%= product.id %></strong></td>
                  <td><strong><%= product.name %></strong></td>
                  <td><%= product.description.substring(0, 50) %>...</td>
                  <td>$<%= parseFloat(product.price).toFixed(2) %></td>
                  <td><span class="status-badge status-completed"><%= product.stock %> units</span></td>
                  <td>
                    <div class="action-buttons">
                      <a href="/admin/products/edit/<%= product.id %>" class="edit-btn">âœï¸ Edit</a>
                      <button class="delete-btn" onclick="deleteProduct('<%= product.id %>')">ğŸ—‘ï¸ Delete</button>
                    </div>
                  </td>
                </tr>
              <% }); %>
            </tbody>
          </table>
        <% } else { %>
          <p style="text-align: center; padding: 2rem; color: #999;">No products found. <a href="/admin/products/add" class="admin-btn" style="display: inline-block; margin-top: 1rem;">Add the first product</a></p>
        <% } %>
      </div>
    </main>
  </div>

  <script>
    function toggleAdminMenu() {
      const sidebar = document.getElementById('adminSidebar');
      sidebar.classList.toggle('active');
    }

    document.querySelectorAll('#adminSidebar a').forEach(link => {
      link.addEventListener('click', () => {
        document.getElementById('adminSidebar').classList.remove('active');
      });
    });

    function deleteProduct(id) {
      if (confirm('Are you sure you want to delete this product?')) {
        fetch('/admin/products/delete/' + id, {method: 'POST'})
          .then(r => r.json())
          .then(data => {
            if (data.success) {
              location.reload();
            } else {
              alert('Error deleting product');
            }
          })
          .catch(err => alert('Error: ' + err));
      }
    }
  </script>
</body>
</html>
