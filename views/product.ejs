<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= product.name %> - E-Hividy</title>
  <link rel="stylesheet" href="/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    .breadcrumb {
      max-width: 1400px;
      margin: 1.5rem auto 0;
      padding: 0 1rem;
      display: flex;
      gap: 0.5rem;
      align-items: center;
      font-size: 0.9rem;
    }

    .breadcrumb a {
      color: #666;
      text-decoration: none;
      transition: color 0.3s;
    }

    .breadcrumb a:hover {
      color: #667eea;
    }

    .breadcrumb span {
      color: #ccc;
    }

    .product-detail-container {
      max-width: 1400px;
      margin: 2rem auto;
      padding: 0 1rem;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4rem;
    }

    /* Image Gallery */
    .product-gallery {
      position: sticky;
      top: 2rem;
    }

    .main-image {
      width: 100%;
      aspect-ratio: 1/1;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 16px;
      overflow: hidden;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .main-image img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      cursor: zoom-in;
      transition: transform 0.3s;
    }

    .main-image img:hover {
      transform: scale(1.1);
    }

    .image-placeholder {
      font-size: 8rem;
      color: #ccc;
    }

    /* Product Info */
    .product-info-detail {
      padding: 1rem 0;
    }

    .product-brand {
      font-size: 0.875rem;
      color: #667eea;
      text-transform: uppercase;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .product-title-detail {
      font-size: 2.5rem;
      font-weight: 700;
      color: #2c3e50;
      margin-bottom: 1rem;
      line-height: 1.2;
    }

    .product-rating-large {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .stars-large {
      color: #ffc107;
      font-size: 1.25rem;
    }

    .rating-text {
      color: #666;
      font-size: 0.9rem;
    }

    .price-section {
      margin-bottom: 2rem;
      padding-bottom: 2rem;
      border-bottom: 2px solid #f0f0f0;
    }

    .current-price-large {
      font-size: 3rem;
      font-weight: 700;
      color: #28a745;
    }

    .original-price-large {
      font-size: 1.5rem;
      color: #999;
      text-decoration: line-through;
      margin-left: 1rem;
    }

    .discount-badge {
      display: inline-block;
      background: #dc3545;
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.875rem;
      font-weight: 600;
      margin-left: 0.5rem;
    }

    .stock-status {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-weight: 600;
      margin-bottom: 1.5rem;
    }

    .stock-in {
      background: #d4edda;
      color: #155724;
    }

    .stock-out {
      background: #f8d7da;
      color: #721c24;
    }

    .stock-low {
      background: #fff3cd;
      color: #856404;
    }

    .description-section {
      margin-bottom: 2rem;
    }

    .description-section h3 {
      font-size: 1.25rem;
      color: #2c3e50;
      margin-bottom: 1rem;
    }

    .description-text {
      color: #555;
      line-height: 1.8;
      font-size: 1rem;
    }

    /* Quantity Selector */
    .quantity-selector {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .quantity-selector label {
      font-weight: 600;
      color: #333;
      margin: 0;
    }

    .quantity-controls {
      display: flex;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      overflow: hidden;
    }

    .qty-btn {
      width: 44px;
      height: 44px;
      border: none;
      background: #f8f9fa;
      color: #333;
      cursor: pointer;
      font-size: 1.25rem;
      transition: all 0.3s;
    }

    .qty-btn:hover {
      background: #667eea;
      color: white;
    }

    .qty-input {
      width: 60px;
      height: 44px;
      border: none;
      text-align: center;
      font-size: 1rem;
      font-weight: 600;
      padding: 0;
    }

    .qty-input:focus {
      outline: none;
    }

    /* Action Buttons */
    .action-buttons {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .btn-add-cart {
      flex: 1;
      padding: 1rem 2rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.75rem;
    }

    .btn-add-cart:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }

    .btn-add-cart:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn-wishlist {
      width: 56px;
      height: 56px;
      border: 2px solid #e9ecef;
      background: white;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1.5rem;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .btn-wishlist:hover {
      border-color: #dc3545;
      color: #dc3545;
      transform: scale(1.05);
    }

    .btn-wishlist.active {
      background: #dc3545;
      border-color: #dc3545;
      color: white;
    }

    /* Product Meta */
    .product-meta {
      padding-top: 2rem;
      border-top: 2px solid #f0f0f0;
    }

    .meta-item {
      display: flex;
      gap: 1rem;
      padding: 0.75rem 0;
      font-size: 0.9rem;
    }

    .meta-label {
      font-weight: 600;
      color: #666;
      min-width: 100px;
    }

    .meta-value {
      color: #333;
    }

    /* Features List */
    .features-list {
      margin-top: 2rem;
      padding: 2rem;
      background: #f8f9fa;
      border-radius: 12px;
    }

    .features-list h3 {
      font-size: 1.25rem;
      color: #2c3e50;
      margin-bottom: 1rem;
    }

    .features-list ul {
      list-style: none;
      padding: 0;
    }

    .features-list li {
      padding: 0.5rem 0;
      padding-left: 1.5rem;
      position: relative;
      color: #555;
    }

    .features-list li::before {
      content: '‚úì';
      position: absolute;
      left: 0;
      color: #28a745;
      font-weight: 700;
    }

    /* Back button */
    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      background: white;
      border: 2px solid #e9ecef;
      border-radius: 12px;
      color: #333;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s;
      margin-bottom: 1rem;
    }

    .back-btn:hover {
      border-color: #667eea;
      color: #667eea;
    }

    /* Toast */
    #toastContainer {
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 1000;
    }

    /* Responsive */
    @media (max-width: 992px) {
      .product-detail-container {
        grid-template-columns: 1fr;
        gap: 2rem;
      }

      .product-gallery {
        position: static;
      }

      .product-title-detail {
        font-size: 2rem;
      }

      .current-price-large {
        font-size: 2.5rem;
      }
    }

    @media (max-width: 768px) {
      .breadcrumb {
        display: none;
      }

      .product-title-detail {
        font-size: 1.75rem;
      }

      .current-price-large {
        font-size: 2rem;
      }

      .action-buttons {
        flex-direction: column;
      }

      .btn-wishlist {
        width: 100%;
        height: 56px;
      }

      .quantity-selector {
        flex-wrap: wrap;
      }
    }
  </style>
</head>
<body>
  <nav>
    <div class="nav-brand">
      <a href="/" style="color: white; text-decoration: none;"><h1>üõçÔ∏è E-Hividy</h1></a>
    </div>

    <div class="nav-search">
      <form action="/" method="GET">
        <input type="text" name="search" placeholder="Search products..." value="<%= typeof search !== 'undefined' ? search : '' %>">
        <button type="submit">üîç</button>
      </form>
    </div>

    <button class="menu-toggle" onclick="toggleMenu()">‚ò∞</button>
    <ul id="navMenu">
      <li><a href="/">Home</a></li>
      <% if (typeof user !== 'undefined' && user) { %>
        <li><a href="/user/account">Account</a></li>
        <li><a href="/cart">Cart</a></li>
        <li><a href="/auth/logout">Logout</a></li>
      <% } else { %>
        <li><a href="/auth/login-page">Login</a></li>
        <li><a href="/auth/register-page">Register</a></li>
      <% } %>
    </ul>
  </nav>

  <div class="breadcrumb">
    <a href="/">Home</a>
    <span>/</span>
    <a href="/#products">Products</a>
    <span>/</span>
    <span style="color: #333;"><%= product.name %></span>
  </div>

  <main>
    <div class="product-detail-container">
      <!-- Left: Image Gallery -->
      <div class="product-gallery">
        <div class="main-image" id="mainImage">
          <% if (product.image) { %>
            <img src="<%= product.image %>" alt="<%= product.name %>" onclick="zoomImage()">
          <% } else { %>
            <span class="image-placeholder">üì¶</span>
          <% } %>
        </div>
      </div>

      <!-- Right: Product Info -->
      <div class="product-info-detail">
        <a href="/" class="back-btn">‚Üê Back to Products</a>

        <div class="product-brand">E-Hividy</div>
        <h1 class="product-title-detail"><%= product.name %></h1>

        <div class="product-rating-large">
          <span class="stars-large">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</span>
          <span class="rating-text">No reviews yet</span>
        </div>

        <div class="price-section">
          <span class="current-price-large">$<%= parseFloat(product.price).toFixed(2) %></span>
          <% if (product.originalPrice) { %>
            <span class="original-price-large">$<%= parseFloat(product.originalPrice).toFixed(2) %></span>
            <span class="discount-badge">Save <%= Math.round((1 - product.price/product.originalPrice) * 100) %>%</span>
          <% } %>
        </div>

        <% if (product.stock > 10) { %>
          <div class="stock-status stock-in">
            <span>‚úì</span> In Stock (<%= product.stock %> available)
          </div>
        <% } else if (product.stock > 0) { %>
          <div class="stock-status stock-low">
            <span>‚ö†</span> Only <%= product.stock %> left - Order soon!
          </div>
        <% } else { %>
          <div class="stock-status stock-out">
            <span>‚úï</span> Out of Stock
          </div>
        <% } %>

        <div class="description-section">
          <h3>Description</h3>
          <div class="description-text"><%= product.description %></div>
        </div>

        <% if (typeof user !== 'undefined' && user) { %>
          <div class="quantity-selector">
            <label for="quantity">Quantity:</label>
            <div class="quantity-controls">
              <button class="qty-btn" onclick="decreaseQty()">‚àí</button>
              <input type="number" id="quantity" class="qty-input" value="1" min="1" max="<%= product.stock %>">
              <button class="qty-btn" onclick="increaseQty()">+</button>
            </div>
          </div>

          <div class="action-buttons">
            <button class="btn-add-cart" onclick="addToCart()" <%= product.stock <= 0 ? 'disabled' : '' %>>
              üõí Add to Cart
            </button>
            <button class="btn-wishlist" onclick="toggleWishlist()" id="wishlistBtn">
              ‚ô°
            </button>
          </div>
        <% } else { %>
          <div class="action-buttons">
            <a href="/auth/login-page" class="btn-add-cart" style="text-decoration: none;">
              üîê Login to Buy
            </a>
          </div>
        <% } %>

        <div class="product-meta">
          <div class="meta-item">
            <span class="meta-label">Product ID:</span>
            <span class="meta-value">#<%= product.id %></span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Category:</span>
            <span class="meta-value">General</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Availability:</span>
            <span class="meta-value"><%= product.stock > 0 ? 'In Stock' : 'Out of Stock' %></span>
          </div>
        </div>

        <div class="features-list">
          <h3>Why Choose This Product?</h3>
          <ul>
            <li>High quality materials and construction</li>
            <li>Designed for durability and longevity</li>
            <li>Great value for money</li>
            <li>Customer satisfaction guaranteed</li>
            <li>Fast and secure shipping</li>
          </ul>
        </div>
      </div>
    </div>
  </main>

  <div id="toastContainer"></div>

  <footer>
    <p>&copy; 2026 E-Hividy. All rights reserved.</p>
  </footer>

  <script>
    function toggleMenu() {
      const menu = document.getElementById('navMenu');
      menu.classList.toggle('active');
    }

    // Close menu when a link is clicked
    document.querySelectorAll('#navMenu a').forEach(link => {
      link.addEventListener('click', () => {
        document.getElementById('navMenu').classList.remove('active');
      });
    });

    // Toast notification
    function showToast(message, type = 'info') {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.style.cssText = `
        background: white;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        animation: slideIn 0.3s ease;
        min-width: 300px;
        border-left: 4px solid ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#667eea'};
      `;

      const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
      toast.innerHTML = `<span>${icon}</span><span>${message}</span>`;
      container.appendChild(toast);

      setTimeout(() => {
        toast.style.animation = 'slideOut 0.3s ease forwards';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `;
    document.head.appendChild(style);

    // Quantity controls
    function decreaseQty() {
      const input = document.getElementById('quantity');
      if (input.value > 1) {
        input.value = parseInt(input.value) - 1;
      }
    }

    function increaseQty() {
      const input = document.getElementById('quantity');
      const max = <%= product.stock %>;
      if (input.value < max) {
        input.value = parseInt(input.value) + 1;
      }
    }

    // Add to cart
    function addToCart() {
      const quantity = document.getElementById('quantity').value;
      const productId = '<%= product.id %>';

      fetch('/cart/add', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({productId, quantity: parseInt(quantity)})
      })
      .then(r => r.json())
      .then(data => {
        if (data.success) {
          showToast('Added to cart!', 'success');
        } else {
          showToast(data.error || 'Error adding to cart', 'error');
        }
      })
      .catch(err => showToast('Error: ' + err, 'error'));
    }

    // Wishlist
    function toggleWishlist() {
      const btn = document.getElementById('wishlistBtn');
      const productId = '<%= product.id %>';

      if (btn.classList.contains('active')) {
        // Remove from wishlist
        showToast('Removed from wishlist', 'info');
        btn.classList.remove('active');
        btn.innerHTML = '‚ô°';
      } else {
        // Add to wishlist
        fetch('/user/wishlist/add', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({productId})
        })
        .then(r => r.json())
        .then(data => {
          if (data.success) {
            showToast('Added to wishlist!', 'success');
            btn.classList.add('active');
            btn.innerHTML = '‚ô•';
          } else {
            showToast(data.error || 'Error', 'error');
          }
        })
        .catch(err => showToast('Error: ' + err, 'error'));
      }
    }

    // Image zoom
    function zoomImage() {
      const img = document.querySelector('.main-image img');
      if (img) {
        img.style.transform = img.style.transform === 'scale(1.5)' ? 'scale(1)' : 'scale(1.5)';
      }
    }
  </script>
</body>
</html>
