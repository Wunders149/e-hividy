<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Details</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <nav>
    <div class="nav-brand">
      <a href="/" style="color: white; text-decoration: none;"><h1>üõçÔ∏è Shop</h1></a>
    </div>
    
    <div class="nav-search">
      <form action="/" method="GET">
        <input type="text" name="search" placeholder="Search products..." value="<%= typeof search !== 'undefined' ? search : '' %>">
        <button type="submit">üîç</button>
      </form>
    </div>

    <button class="menu-toggle" onclick="toggleMenu()">‚ò∞</button>
    <ul id="navMenu">
      <li><a href="/">Home</a></li>
      <% if (user) { %>
        <li><a href="/user/account">Account</a></li>
        <li><a href="/cart">Cart</a></li>
        <li><a href="/auth/logout">Logout</a></li>
      <% } else { %>
        <li><a href="/auth/login-page">Login</a></li>
        <li><a href="/auth/register-page">Register</a></li>
      <% } %>
    </ul>
  </nav>

  <script>
    function toggleMenu() {
      const menu = document.getElementById('navMenu');
      menu.classList.toggle('active');
    }
  </script>

  <main>
    <div class="product-details">
      <div class="product-image-container">
        <% if (product.image) { %>
          <img src="<%= product.image %>" alt="<%= product.name %>" class="main-product-image">
        <% } else { %>
          <div style="font-size: 8rem; color: #6c757d;">üì¶</div>
        <% } %>
      </div>
      
      <div class="product-info">
        <h2><%= product.name %></h2>
        <div class="price">$<%= parseFloat(product.price).toFixed(2) %></div>
        <p class="description"><%= product.description %></p>
        
        <div class="stock-info mt-2">
          <span class="stock <%= product.stock > 0 ? 'text-success' : 'text-danger' %>">
            Status: <%= product.stock > 0 ? 'In Stock (' + product.stock + ')' : 'Out of Stock' %>
          </span>
        </div>

        <% if (user) { %>
          <form id="addToCartForm" class="mt-3">
            <div class="form-group mb-2">
              <label for="quantity">Quantity:</label>
              <input type="number" id="quantity" name="quantity" min="1" max="<%= product.stock %>" value="1" required style="max-width: 120px;">
            </div>
            <button type="submit" class="btn btn-primary" <%= product.stock <= 0 ? 'disabled' : '' %>>
              <%= product.stock > 0 ? 'Add to Cart' : 'Out of Stock' %>
            </button>
          </form>
        <% } else { %>
          <div class="mt-3">
            <a href="/auth/login-page" class="btn btn-primary">Login to Buy</a>
          </div>
        <% } %>
        
        <div class="mt-3">
          <a href="/" class="btn btn-secondary">Back to Products</a>
        </div>
      </div>
    </div>
  </main>

  <script>
    document.getElementById('addToCartForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const quantity = document.getElementById('quantity').value;
      const productId = '<%= product.id %>';
      
      try {
        const response = await fetch('/cart/add', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ productId, quantity: parseInt(quantity) })
        });
        
        const data = await response.json();
        if (response.ok) {
          alert('Product added to cart!');
        } else {
          alert(data.error || 'Error adding to cart');
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Error adding to cart');
      }
    });
  </script>

  <style>
    .description {
      margin: 1.5rem 0;
      line-height: 1.8;
      font-size: 1.1rem;
      color: #555;
    }
    
    .price {
      font-weight: 700;
      color: #28a745;
    }
  </style>
</body>
</html>
